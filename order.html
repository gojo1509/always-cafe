<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- <link rel="stylesheet" href="./assets/css/reset.css" /> -->
    <link
      rel="shortcut icon"
      href="./assets/icon/always.jpg"
      type="image/x-icon"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Playwrite+DK+Loopet:wght@100..400&family=Sen&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
    />
    <link rel="stylesheet" href="./assets/css/style.css" />
    <link rel="stylesheet" href="./assets/css/order.css" />

    <title>ƒê·∫∑t mua</title>
    <script src="https://cdn.emailjs.com/dist/email.min.js"></script>
    <script>
      (function () {
        emailjs.init("xQXihX8dgzY3t7huO");
      })();
    </script>
  </head>
  <body>
    <!-- header -->

    <!-- content -->
    <div class="content-dh">
      <div class="form-container">
        <h2>üõí ƒê·∫∑t H√†ng Nhi·ªÅu S·∫£n Ph·∫©m</h2>
        <form id="orderForm">
          <div class="form-group">
            <label for="name">T√™n kh√°ch h√†ng</label>
            <input
              type="text"
              id="name"
              name="name"
              placeholder="Nh·∫≠p t√™n c·ªßa b·∫°n"
              required
            />
          </div>

          <div class="form-group">
            <label>S·∫£n ph·∫©m</label>
            <div id="productList">
              <div class="product-row">
                <select name="product[]">
                  <option value="" disabled selected hidden>
                    Ch·ªçn s·∫£n ph·∫©m
                  </option>
                  <option value="Bia b∆°">Bia b∆°</option>
                  <option value="Cam l·∫•p l√°nh">Cam l·∫•p l√°nh</option>
                  <option value="Tr√† ti√™n tri">Tr√† ti√™n tri</option>
                  <option value="N·ª• h√¥n th·∫ßn ch·∫øt">N·ª• h√¥n th·∫ßn ch·∫øt</option>
                  <option value="Phoenix fire">Phoenix fire</option>
                  <option value="Ph√∫c l·∫°c d∆∞·ª£c">Ph√∫c l·∫°c d∆∞·ª£c</option>
                  <option value="Ch√¢n d∆∞·ª£c">Ch√¢n d∆∞·ª£c</option>
                  <option value="Chi·∫øc c·ªëc l·ª≠a">Chi·∫øc c·ªëc l·ª≠a</option>
                  <option value="ƒêa qu·∫£ d·ªãch">ƒêa qu·∫£ d·ªãch</option>
                  <option value="Hoa qu·∫£ r·ª´ng c·∫•m">Hoa qu·∫£ r·ª´ng c·∫•m</option>
                  <option value="Thu·ªëc l√∫">Thu·ªëc l√∫</option>
                  <option value="Tr√† t·∫ßm ma">Tr√† t·∫ßm ma</option>
                  <option value="D∆∞·ª£c huy·∫øt r·ªìng">D∆∞·ª£c huy·∫øt r·ªìng</option>
                  <option value="D∆∞·ª£c h·ªìn l√¨a kh·ªèi x√°c">
                    D∆∞·ª£c h·ªìn l√¨a kh·ªèi x√°c
                  </option>
                  <option value="L·ªùi nguy·ªÅn ng∆∞·ªùi c√°">
                    L·ªùi nguy·ªÅn ng∆∞·ªùi c√°
                  </option>
                  <option value="N∆∞·ªõc √©p m·∫≠n xui khi·∫øn">
                    N∆∞·ªõc √©p m·∫≠n xui khi·∫øn
                  </option>
                  <option value="Scarlet bravery">Scarlet bravery</option>
                  <option value="Cunning emerald">Cunning emerald</option>
                  <option value="Sapphire wisdom">Sapphire wisdom</option>
                  <option value="Humble amber">Humble amber</option>
                </select>
                <input
                  type="number"
                  name="quantity[]"
                  placeholder="S·ªë l∆∞·ª£ng"
                  min="1"
                  value="1"
                />
                <button type="button" onclick="removeProduct(this)">‚úñ</button>
              </div>
            </div>
            <button type="button" id="addProduct">+ Th√™m s·∫£n ph·∫©m</button>
          </div>

          <div class="form-group">
            <label for="address">ƒê·ªãa ch·ªâ giao h√†ng</label>
            <textarea
              id="user_address"
              name="user_address"
              rows="3"
              required
              placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ c·ªßa b·∫°n"
            ></textarea>
          </div>

          <div class="form-group">
            <label for="number">S·ªë ƒëi·ªán tho·∫°i</label>
            <input
              type="tel"
              id="user_phone"
              name="user_phone"
              required
              placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i c·ªßa b·∫°n"
            />
          </div>
          <input
            type="email"
            name="user_email"
            id="user_email"
            placeholder="Email c·ªßa b·∫°n"
            required
          />
          <input type="hidden" name="order_details" id="order_details" />
          <input type="hidden" name="total_price" id="total_price" />

          <button type="submit">G·ª≠i ƒê∆°n H√†ng</button>
        </form>
      </div>
    </div>
    <!-- footer -->

    <script>
      const productList = document.getElementById("productList");
      const addProductBtn = document.getElementById("addProduct");

      function addNewProductRow() {
        const row = document.createElement("div");
        row.className = "product-row";
        row.innerHTML = `
      <select name="product[]">
        <option value="" disabled selected hidden>Ch·ªçn s·∫£n ph·∫©m</option>
        <option value="Bia b∆°">Bia b∆°</option>
        <option value="Cam l·∫•p l√°nh">Cam l·∫•p l√°nh</option>
        <option value="Tr√† ti√™n tri">Tr√† ti√™n tri</option>
        <option value="N·ª• h√¥n th·∫ßn ch·∫øt">N·ª• h√¥n th·∫ßn ch·∫øt</option>
        <option value="Phoenix fire">Phoenix fire</option>
        <option value="Ph√∫c l·∫°c d∆∞·ª£c">Ph√∫c l·∫°c d∆∞·ª£c</option>
        <option value="Ch√¢n d∆∞·ª£c">Ch√¢n d∆∞·ª£c</option>
        <option value="Chi·∫øc c·ªëc l·ª≠a">Chi·∫øc c·ªëc l·ª≠a</option>
        <option value="ƒêa qu·∫£ d·ªãch">ƒêa qu·∫£ d·ªãch</option>
        <option value="Hoa qu·∫£ r·ª´ng c·∫•m">Hoa qu·∫£ r·ª´ng c·∫•m</option>
        <option value="Thu·ªëc l√∫">Thu·ªëc l√∫</option>
        <option value="Tr√† t·∫ßm ma">Tr√† t·∫ßm ma</option>
        <option value="D∆∞·ª£c huy·∫øt r·ªìng">D∆∞·ª£c huy·∫øt r·ªìng</option>
        <option value="D∆∞·ª£c h·ªìn l√¨a kh·ªèi x√°c">D∆∞·ª£c h·ªìn l√¨a kh·ªèi x√°c</option>
        <option value="L·ªùi nguy·ªÅn ng∆∞·ªùi c√°">L·ªùi nguy·ªÅn ng∆∞·ªùi c√°</option>
        <option value="N∆∞·ªõc √©p m·∫≠n xui khi·∫øn">N∆∞·ªõc √©p m·∫≠n xui khi·∫øn</option>
        <option value="Scarlet bravery">Scarlet bravery</option>
        <option value="Cunning emerald">Cunning emerald</option>
        <option value="Sapphire wisdom">Sapphire wisdom</option>
        <option value="Humble amber">Humble amber</option>
      </select>
      <input type="number" name="quantity[]" placeholder="S·ªë l∆∞·ª£ng" min="1" value="1">
      <button type="button" onclick="removeProduct(this)">‚úñ</button>
    `;
        productList.appendChild(row);
      }
      addProductBtn.addEventListener("click", () => {
        const selects = productList.querySelectorAll(
          "select[name='product[]']"
        );
        const quantities = productList.querySelectorAll(
          "input[name='quantity[]']"
        );
        const lastSelect = selects[selects.length - 1];
        const lastQuantity = quantities[quantities.length - 1];

        if (selects.length === 0) {
          addNewProductRow();
          return;
        }

        if (!lastSelect.value) {
          alert("‚ö†Ô∏è H√£y ch·ªçn s·∫£n ph·∫©m tr∆∞·ªõc khi th√™m d√≤ng m·ªõi.");
          return;
        }
        if (!lastQuantity.value || Number(lastQuantity.value) <= 0) {
          alert("‚ö†Ô∏è Vui l√≤ng nh·∫≠p s·ªë l∆∞·ª£ng l·ªõn h∆°n 0.");
          return;
        }

        addNewProductRow();
      });

      window.removeProduct = function (button) {
        button.parentElement.remove();
      };

      document
        .getElementById("orderForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const userName = document.getElementById("name").value.trim();
          const userPhone = document.getElementById("user_phone").value.trim();
          const userAddress = document
            .getElementById("user_address")
            .value.trim();
          const userEmail = document.getElementById("user_email").value.trim();

          if (userName.length < 2) {
            alert("‚ö†Ô∏è T√™n ph·∫£i c√≥ √≠t nh·∫•t 2 k√Ω t·ª±.");
            return;
          }

          if (!/^(0[0-9]{9,10})$/.test(userPhone)) {
            alert(
              "‚ö†Ô∏è S·ªë ƒëi·ªán tho·∫°i kh√¥ng h·ª£p l·ªá (b·∫Øt ƒë·∫ßu b·∫±ng 0, g·ªìm 10-11 s·ªë)."
            );
            return;
          }

          const products = document.querySelectorAll(
            "select[name='product[]']"
          );
          const quantities = document.querySelectorAll(
            "input[name='quantity[]']"
          );

          let selectedProducts = [];
          let totalPrice = 0;

          for (let i = 0; i < products.length; i++) {
            let product = products[i].value;
            let quantity = Number(quantities[i].value);

            if (product && quantity > 0) {
              selectedProducts.push(
                `${i + 1}. ${product} - S·ªë l∆∞·ª£ng: ${quantity}`
              );
              totalPrice += quantity * 60000;
            }
          }

          if (selectedProducts.length === 0) {
            alert("‚ö†Ô∏è Vui l√≤ng ch·ªçn √≠t nh·∫•t 1 s·∫£n ph·∫©m.");
            return;
          }

          const orderDetails = selectedProducts.join("\n");

          document.getElementById("order_details").value =
            selectedProducts.join("\n");
          document.getElementById("total_price").value =
            totalPrice.toLocaleString("vi-VN") + " ‚Ç´";
          document.getElementById("user_phone").value = userPhone;
          document.getElementById("user_address").value = userAddress;

          emailjs
            .sendForm("service_628sr7h", "template_pz46ocp", this)
            .then(() => {
              alert("‚úÖ ƒê∆°n h√†ng ƒë√£ ƒë∆∞·ª£c g·ª≠i th√†nh c√¥ng!");
              this.reset();
              while (productList.children.length > 1) {
                productList.removeChild(productList.lastChild);
              }
            })
            .catch((error) => {
              alert("‚ùå G·ª≠i ƒë∆°n h√†ng th·∫•t b·∫°i. Vui l√≤ng th·ª≠ l·∫°i.");
              console.error(error);
            });
        });
    </script>
  </body>
</html>
